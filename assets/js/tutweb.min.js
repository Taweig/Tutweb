/*! tutweb 12-12-2013 */
function calcAge(a){var b=+new Date(a);return~~((Date.now()-b)/315576e5)}function initializeVideoJS(){videojs("tutvideo").ready(function(){var a=this;console.log(a.contentEl());var b=document.createElement("audio");b.setAttribute("preload","auto"),b.autobuffer=!0;var c=document.createElement("source");c.type="audio/wav",c.src=$(a.contentEl()).find("> video").data("audio-src"),b.appendChild(c),b.load(),b.volume=1,a.on("volumechange",function(){b.volume=a.volume()}),a.on("play",function(){b.play()}),a.on("pause",function(){b.pause()}),a.on("ended",function(){b.pause()}),a.on("timeupdate",function(){Math.ceil(b.currentTime)!=Math.ceil(a.currentTime())&&(b.currentTime=a.currentTime())})})}function getVideos(a){var b=$.Deferred(),c={search:"",tag:"",yearMin:"",yearMax:"",category1:"",category2:"",category3:"",featured:""},d=$.extend({},c,a),e=$.ajax({url:SITEURL+"/php/getvideos.php",type:"GET",data:d,dataType:"json",success:function(a){$(a.result).each(function(b){a.result[b]=parseVideo(this)}),b.resolve(a)}});return e.fail(function(a,b){alert("Request failed: "+b)}),b}function getVideo(a){var b=$.Deferred(),c={ID:a},d=$.ajax({url:SITEURL+"/php/getvideo.php",type:"GET",data:c,dataType:"json",success:function(a){$(a.result).each(function(b){a.result[b]=parseVideo(this)}),b.resolve(a)}});return d.fail(function(a,b){alert("getVideo Request failed: "+b)}),b}function parseVideo(a){return a.images=a.images.split(" , "),a.tags=a.tags.split(", "),a.dob=new Date(a.dob),a.savedate=new Date(a.savedate),a}function initializeHome(){loadFeaturedSlider()}function loadFeaturedSlider(){console.log("loadFeaturedSlider"),getVideos().done(function(a){$(a.result).each(function(){var a=$('<a data-rsw="1140" data-rsh="760"><video id="tutvideo" data-audio-src="'+this.AudioSource+'" class="video-js vjs-default-skin"controls preload="auto" width="100%" height="100%"poster="'+this.images[1]+'"data-setup="{example_option:true}"><source src="'+this.videosource+'" type="video/webm" /></video><img class="rsTmb" src="'+this.images[0]+'"></a>');$("#video-gallery").append(a)}),initializeFeaturedSlider()})}function initializeFeaturedSlider(){$("#video-gallery").royalSlider({arrowsNav:!1,fadeinLoadedSlide:!0,controlNavigationSpacing:0,controlNavigation:"thumbnails",keyboardNavEnabled:!0,imageScaleMode:"fill",imageAlignCenter:!0,slidesSpacing:0,loop:!1,loopRewind:!0,numImagesToPreload:3,sliderDrag:!1,video:{autoHideArrows:!0,autoHideControlNav:!1,autoHideBlocks:!0},thumbs:{appendSpan:!0,firstMargin:!0,paddingBottom:0,spacing:20},autoScaleSlider:!0,autoScaleSliderWidth:1140,autoScaleSliderHeight:760,imgWidth:640,imgHeight:360}),initializeVideoJS()}function toggleInfoBubble(a){infoBubble.setContent('<div id="content"><h6>'+a.title+'</h6><p style="font-size:100%;">'+a.description+"</p></div>"),infoBubble.open(map,a)}function initializeMap(){var a=new google.maps.LatLng(52.176,5.75),b=[{elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",stylers:[{visibility:"off"}]},{featureType:"administrative.province",stylers:[{visibility:"off"}]},{}],c={zoom:7,center:a,styles:b,scrollwheel:!1};map=new google.maps.Map(document.getElementById("tuthutMap"),c),infoBubble=new InfoBubble({maxWidth:300,content:"bla"}),loadMapMarkers()}function loadMapMarkers(){var a={url:"assets/images/tuthut-marker.png",size:new google.maps.Size(36,50),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(18,50)};$("#tuthutLocations tr").each(function(){var b={};b.lat=$(this).data("lat"),b.lng=$(this).data("lng"),b.title=$(this).data("title"),b.description=$(this).data("description");var c=new google.maps.Marker({position:new google.maps.LatLng(b.lat,b.lng),map:map,title:b.title,description:b.description,icon:a});$(this).click(function(a){return function(){toggleInfoBubble(a)}}(c)),google.maps.event.addListener(c,"click",function(a){return function(){toggleInfoBubble(a)}}(c))})}function initializeStories(){$("#search-stories").submit(function(a){a.preventDefault(),console.log($(this).find("#maxYear"));var b={search:$(this).find("#search").val(),yearMin:$(this).find("#yearMin").val(),yearMax:$(this).find("#yearMax").val(),category1:$(this).find("#category1").val(),category2:$(this).find("#category2").val(),category3:$(this).find("#category3").val()};return $("#storyContainer").html("<h5>Loading...</h5>"),getVideos(b).done(function(a){$("#storyContainer").html(""),a.result.length>0?$(a.result).each(function(){var a=$('<div class="col-sm-6 col-md-4"><div class="thumbnail" data-video-src="'+this.videosource+'" data-audio-src="'+this.audiosource+'"><a href="story.php?id='+this.ID+'"><img src="'+this.images[0]+'" alt=""><div class="caption"><strong>'+this.title+"</strong></div></a></div></div>");$("#storyContainer").append(a)}):$("#storyContainer").append('<h4 class="col-md-12">Sorry, geen resultaten gevonden...</h4>')}),!1}),""!==$("#search").val()?$("#search-stories").submit():loadStories()}function loadStories(){getVideos().done(function(a){showStories($("#storyContainer"),a.result)})}function showStories(a,b){$(b).each(function(){var b=$('<div class="col-sm-6 col-md-4"><div class="thumbnail" data-video-src="'+this.videosource+'" data-audio-src="'+this.audiosource+'"><a href="story.php?id='+this.ID+'"><img src="'+this.images[0]+'" alt=""><div class="caption"><strong>'+this.title+"</strong></div></a></div></div>");a.append(b)})}function searchStories(){}function initializeStory(){loadStory(storyID)}function loadStory(a){getVideo(a).done(function(a){if(a.result[0]){var b=a.result[0];console.log(b),$(".video-details .title").html(b.title),$(".video-details .date").html(b.savedate.getDate()+"-"+(b.savedate.getMonth()+1)+"-"+b.savedate.getFullYear()),$(".video-details .description").html(b.description);var c=$('<video id="tutvideo" data-audio-src="'+b.audiosource+'" class="video-js vjs-default-skin"controls preload="auto" width="100%" height="100%"poster="'+b.images[1]+'"data-setup="{example_option:true}"><source src="'+b.videosource+'" type="video/webm" /></video>');$("#video-holder").append(c),initializeVideoJS(),$(".video-details .name-age").html(b.name+" ("+calcAge(b.dob)+")"),$(".video-details .year").html(b.year),$(".video-details .object").html(b.object),$(".video-details .location").html(b.location),$(".video-details .cast").html(b.cast),$(".video-details .meta-category1").data("value",b.category1),$(".video-details .meta-category2").data("value",b.category2),$(".video-details .meta-category3").data("value",b.category3),$(b.tags).each(function(){$(".video-details .meta-tags").append($('<span><a href="'+SITEURL+"/tag.php?tag="+this+'" class="btn btn-primary">'+this+"</a> </span>"))});var d=$(".info-slider");d.length>0&&d.slider({min:1,max:5,range:"min",value:0,disabled:!0,orientation:"horizontal",create:function(){$(this).slider("value",$(this).data("value"))}})}})}function initializeTag(){loadStoriesByTag()}function loadStoriesByTag(){console.log("Yo Mama"),getVideos({tag:TAG}).done(function(a){showStories($("#storyContainer"),a.result)})}var KofferStory={common:{init:function(){},finalize:function(){}},index:{init:function(){initializeHome(),initializeMap()}},stories:{init:function(){initializeStories()}},story:{init:function(){initializeStory()}},tag:{init:function(){initializeTag()}},agenda:{init:function(){initializeMap()}}},UTIL={fire:function(a,b,c){var d=KofferStory;b=void 0===b?"init":b,""!==a&&d[a]&&"function"==typeof d[a][b]&&d[a][b](c)},loadEvents:function(){UTIL.fire("common"),$.each(document.body.className.replace(/-/g,"_").split(/\s+/),function(a,b){UTIL.fire(b)}),UTIL.fire("common","finalize")}};$(document).ready(UTIL.loadEvents),String.prototype.repeat=function(a){return new Array(a+1).join(this)},function(a){a.widget("ui.customspinner",a.ui.spinner,{widgetEventPrefix:a.ui.spinner.prototype.widgetEventPrefix,_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'></span></a><a class='ui-spinner-button ui-spinner-down ui-corner-br'><span class='ui-icon "+this.options.icons.down+"'></span></a>"}}),a("#spinner-01, .spinner").customspinner({min:a(this).data("min"),max:a(this).data("max")}).on("focus",function(){a(this).closest(".ui-spinner").addClass("focus")}).on("blur",function(){a(this).closest(".ui-spinner").removeClass("focus")}),a("select").selectpicker({style:"btn-hg btn-primary",menuStyle:"dropdown-inverse"});var b=a(".input-slider");b.length>0&&b.slider({min:1,max:5,value:3,range:"min",orientation:"horizontal",slide:function(b,c){a(this).parent().find(".inputNumber").val(c.value)},create:function(){a(this).slider("value",a(this).parent().find(".inputNumber").val())}})}(jQuery);var map,infoBubble;